# LINE スケジュール通知システム

社内グループや個人に定期的にLINE通知を送信するスケジューリングアプリケーションです。

## 主な機能

- **スケジュール管理**: Cron式を使った柔軟な通知スケジュール設定
- **送信先管理**: 個人・グループの送信先を事前登録
- **通知履歴**: 送信履歴の確認
- **手動実行**: スケジュールの即時実行
- **GUI管理画面**: ブラウザから簡単に設定・管理

## セットアップ

### 1. LINE Messaging APIの設定

1. [LINE Developers](https://developers.line.biz/ja/)にアクセス
2. プロバイダーとチャンネルを作成
3. Messaging APIを有効化
4. チャンネルアクセストークンとチャンネルシークレットを取得

### 2. アプリケーションのセットアップ

```bash
cd line-scheduler

# 依存関係のインストール
npm install

# 環境変数の設定
cp .env.example .env
```

`.env`ファイルを編集して、LINE APIの認証情報を設定：

```
LINE_CHANNEL_ACCESS_TOKEN=あなたのチャンネルアクセストークン
LINE_CHANNEL_SECRET=あなたのチャンネルシークレット
PORT=3000
DATABASE_PATH=./database.sqlite
```

### 3. アプリケーションの起動

```bash
# 本番環境
npm start

# 開発環境（自動リロード付き）
npm run dev
```

アプリケーションは以下のURLで起動します：
- **ローカル**: http://localhost:3000
- **ネットワーク**: http://[あなたのIPアドレス]:3000 （起動時に表示されます）

### ネットワークアクセスについて

同じWi-Fiネットワーク上の他のデバイスからもアクセス可能です：

1. サーバー起動時に表示されるネットワークURLをコピー
2. 他のデバイス（スマホ、タブレット、他のPC）のブラウザでアクセス
3. 管理画面が共有されます

**例**: `http://192.168.1.100:3000`

## 使い方

### 1. 送信先の登録

1. 「送信先管理」タブを開く
2. 名前とLINE IDを入力
3. タイプ（個人/グループ）を選択
4. 「送信先を登録」をクリック

### 2. スケジュールの作成

1. 「スケジュール管理」タブを開く
2. スケジュール名とメッセージを入力
3. 送信先を選択（全体配信も可能）
4. スケジュールを設定：
   - プリセットボタンで簡単設定
   - またはCron式で詳細設定
5. 「スケジュール作成」をクリック

### 3. Cron式の例

- `0 9 * * 1-5` - 平日の朝9時
- `0 18 * * 1-5` - 平日の夕方6時
- `0 10 * * 1` - 毎週月曜日の10時
- `0 9 1 * *` - 毎月1日の朝9時
- `*/30 * * * *` - 30分ごと

Cron式の形式: `分 時 日 月 曜日`

### 4. 送信履歴の確認

「送信履歴」タブで過去の送信記録を確認できます。

## 送信先IDの取得方法

### 🔧 自動取得（推奨）
アプリの「ID取得・デバッグ」タブを使用：

1. **Webhook設定**
   - LINE DevelopersでWebhook URLを設定
   - URL: `http://あなたのIP:3000/webhook`
   - 「Webhookの利用」をオンにする

2. **グループID取得**
   - LINE公式アカウントをグループに招待
   - グループでメッセージを送信
   - サーバーコンソールで🎯マークのIDを確認

3. **ユーザーID取得**
   - LINE公式アカウントに個人でメッセージ送信
   - サーバーコンソールでユーザーIDを確認

### 🔍 手動取得
- LINE Developers Console のMessaging API設定
- ユーザー・グループとのやり取りログから取得

## 注意事項

- LINE Messaging APIの利用には料金が発生する場合があります
- 1日あたりの送信数には制限があります
- 本番環境で使用する場合は、適切なセキュリティ対策を実施してください
- データベースファイル（database.sqlite）は定期的にバックアップを取ってください

## トラブルシューティング

### 「LINE APIの設定が完了していません」と表示される
→ `.env`ファイルが正しく設定されているか確認してください

### 通知が送信されない
→ チャンネルアクセストークンが有効か確認してください
→ 送信先IDが正しいか確認してください
→ スケジュールが「有効」になっているか確認してください

### スケジュールが実行されない
→ Cron式が正しいか確認してください
→ サーバーが起動しているか確認してください

## 技術仕様

- **バックエンド**: Node.js + Express
- **データベース**: SQLite (Sequelize ORM)
- **スケジューラー**: node-cron
- **LINE API**: axios
- **フロントエンド**: HTML/CSS/JavaScript

## ライセンス

MIT